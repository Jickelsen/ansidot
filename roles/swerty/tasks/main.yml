---
###############################################################################
# Swerty

- name: Swerty | Add Swerty to /x11/xkb/symbols/se | blockinfile
  become: yes
  blockinfile:
    block: "{{ lookup('file', '../files/swerty.txt') }}"
    path: /usr/share/X11/xkb/symbols/se

- name: Swerty | Add variant to evdev.xml | xml
  become: yes
  xml:
    path: /usr/share/X11/xkb/rules/evdev.xml
    xpath: '/xkbConfigRegistry/layoutList/layout/variantlist[variant/configitem/description = "Swedish (Dvorak)"]'
    backup: yes
    input_type: xml
    add_children:
      - |
        <variant>
          <configItem>
            <name>swerty</name>
            <description>Swerty</description>
          </configItem>
        </variant>

- name: Swerty | Add variant to evdev.lst | lineinfile
  become: yes
  lineinfile:
    path: /usr/share/X11/xkb/rules/evdev.lst
    insertafter: "! variant"
    line: "  swerty          se: Swerty"

- name: Swerty | Set layout | dconf
  become: yes
  become_user: "{{dotfiles_user}}"
  tags: gnome
  dconf:
    key: "/org/gnome/desktop/input-sources/sources"
    value: "[('xkb', 'Swerty')]"
    state: present

- name: Register uid of {{dotfiles_user}}
  command: id -u {{dotfiles_user}}
  tags: gnome
  register: uid

- name: Swerty | Restart Gnome Shell | shell
  become: yes
  become_user: "{{dotfiles_user}}"
  tags: gnome
  shell: busctl --user call org.gnome.Shell /org/gnome/Shell org.gnome.Shell Eval s 'Meta.restart("Restarting...")'
  environment:
    XDG_RUNTIME_DIR: /run/user/{{uid.stdout}}

